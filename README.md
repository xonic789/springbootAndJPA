# JPA Study
## Hello
**영속과 준영속의 차이점 명확히 이해!**

- 준영속 엔티티는 생성후 DB에 한번 들어간 식별자가 있는 엔티티를 말한다.
    - 준영속 엔티티를 수정하는 2가지 방법
        1. 변경감지를 이용

            ```
            //영속 상태이다.
            Item findItem = itemRepository.findOne(itemId);
            ```

           영속 엔티티가 변경된 것을 JPA가 찾는다.

        2. merge를 이용
            - 준영속 상태를 영속 상태로 변경할 때 사용하는 기능이다.
            - 만약 파라미터 중 null 이면 null로 업데이트 될 위험이 있다. (실무에서 사용하지 않는다)
    - 웬만하면 변경 감지를 사용한다. (find하여 영속상태에서 변경해준다)

## 결론

- 엔티티 레벨에서 다 찾을 수 있게 설계하여야 한다.
- 컨트롤러에서 어설프게 엔티티를 생성하지 않는다.
- 트랜잭션이 있는 서비스 계층에 식별자 (`id`)와 변경할 데이터를 명확하게 전달 (파라미터 or dto)
- 트랜잭션이 있는 서비스 계층에서 영속상태의 엔티티를 조회하고 (find) 엔티티의 데이터를 직접 변경한다.
- 트랜잭션 커밋 시점에 변경 감지가 실행된다.

일대일 , 다대다, 일대다 관계 설정을 할때 주인설정, 거울설정이 있어야한다(?)